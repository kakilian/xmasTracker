{% extends "base.html" %}
{% block title %}Wishlist Details{% endblock %}
{% block content %}
<main class="container py-4 py-md-5">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">
      <div class="mb-3">
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'wishlist_list' %}">
          <i class="bi bi-arrow-left"></i> Back to My Wishlists
        </a>
      </div>
      <header class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-3 mb-4">
        <div>
          <h1 class="h3 mb-1">{{ wishlist.title }}</h1>
          <p class="text-muted mb-0">for {{ wishlist.person_name }}</p>
        </div>
        <a class="btn btn-primary" href="{% url 'item_create' wishlist.pk %}">
          <i class="bi bi-plus-circle"></i> Add Item
        </a>
      </header>

      {% if items %}
      <ul class="list-group shadow-sm">
        {% for item in items %}
          <li class="list-group-item {% if item.is_purchased %}bg-light{% endif %}">
            <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
              <div class="flex-grow-1">
                <div class="fw-semibold mb-1 {% if item.is_purchased %}text-decoration-line-through text-muted{% endif %}">
                  {{ item.description }}
                </div>
                {% if item.url %}
                  <a href="{{ item.url }}" target="_blank" rel="noopener" class="small d-inline-block mb-1">
                    <i class="bi bi-link-45deg"></i> View link
                  </a>
                {% endif %}
                {% if item.notes %}
                  <div class="small text-muted">{{ item.notes }}</div>
                {% endif %}
              </div>
              <div class="d-flex flex-row flex-md-column align-items-start align-items-md-end gap-2">
                <div class="d-flex flex-wrap gap-2 align-items-center">
                  {% if item.priority == 1 %}
                    <span class="badge bg-danger">High Priority</span>
                  {% elif item.priority == 2 %}
                    <span class="badge bg-warning text-dark">Medium Priority</span>
                  {% else %}
                    <span class="badge bg-info text-dark">Low Priority</span>
                  {% endif %}
                  <form method="post" action="{% url 'item_toggle_purchased' wishlist.pk item.pk %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm {% if item.is_purchased %}btn-success{% else %}btn-outline-secondary{% endif %}" 
                            title="Mark as {% if item.is_purchased %}not purchased{% else %}purchased{% endif %}">
                      <i class="bi bi-{% if item.is_purchased %}check-circle-fill{% else %}circle{% endif %}"></i>
                      <span class="d-none d-sm-inline">{{ item.is_purchased|yesno:'Purchased,Mark as Purchased' }}</span>
                    </button>
                  </form>
                </div>
                <div class="d-flex gap-2">
                  <a href="{% url 'item_edit' wishlist.pk item.pk %}" class="btn btn-sm btn-outline-info" title="Edit item">
                    <i class="bi bi-pencil"></i>
                  </a>
                  <form method="post" action="{% url 'item_delete' wishlist.pk item.pk %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this item?')" title="Delete item">
                      <i class="bi bi-trash"></i>
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
      {% else %}
        <div class="alert alert-info" role="alert">
          No items yet. <a href="{% url 'item_create' wishlist.pk %}" class="alert-link">Add your first item!</a>
        </div>
      {% endif %}
    </div>
  </div>
</main>
{% endblock %}
